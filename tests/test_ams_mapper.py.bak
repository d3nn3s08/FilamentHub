import json
from app.services.ams_parser import parse_ams
from app.services.universal_mapper import UniversalMapper
from app.services.printer_data import PrinterData

# -----------------------------
# HIER Test-JSON einfügen:
#------------------------------
TEST_JSON = {
    "ams": {
        "modules": [
            {
                "ams_id": 0,
                "active_tray": 1,
                "tray_count": 4,
                "trays": [
                    { "tray_id": 0, "tray_uuid": "UUID-A0-S0", "material": "PLA" },
                    { "tray_id": 1, "tray_uuid": "UUID-A0-S1", "material": "PETG" },
                    { "tray_id": 2, "tray_uuid": None,          "material": None },
                    { "tray_id": 3, "tray_uuid": "UUID-A0-S3", "material": "ABS" }
                ]
            }
        ]
    }
}

# -------------------------------
# TEST CODE
# -------------------------------
mapper = UniversalMapper()
out = PrinterData()

print("Parsing AMS …")
ams_units = parse_ams(TEST_JSON)
print("parse_ams() result:", ams_units)

print("\nRunning UniversalMapper …")
mapper.map_ams_block(TEST_JSON, out)

print("\nMapper Result:")
print(out.ams_units)
