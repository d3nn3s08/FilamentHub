<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drucker - FilamentHub</title>
    <link rel="stylesheet" href="/frontend/dashboard.css">
    <link rel="stylesheet" href="/frontend/materials.css">
</head>
<body>
    <div class="notification-box" id="notificationBox" style="position:fixed;top:20px;right:20px;z-index:9999;min-width:220px;max-width:350px;display:none;"></div>
    <div class="container">

        <!-- HEADER -->
        <div class="header">
            <h1>üñ®Ô∏è Drucker</h1>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="openAddModal()">
                    ‚ûï Drucker hinzuf√ºgen
                </button>
                <button class="btn btn-secondary" onclick="scanForPrinters()" id="scanPrintersBtn">
                    üîç Netzwerk-Scan
                </button>
                <a href="/" class="btn btn-secondary">‚Üê Dashboard</a>
            </div>
        </div>

        <!-- NAVIGATION -->
        <div class="nav">
            <a href="/" class="nav-btn">üìä Dashboard</a>
            <a href="/materials" class="nav-btn">üì¶ Materialien</a>
            <a href="/spools" class="nav-btn">üßµ Spulen</a>
            <a href="/printers" class="nav-btn active">üñ®Ô∏è Drucker</a>
            <a href="/jobs" class="nav-btn">üìã Jobs</a>
        </div>

        <!-- FOUND PRINTERS -->
        <div id="foundPrintersGrid" style="margin-bottom: 30px;"></div>

        <!-- PRINTERS GRID -->
        <div id="printersGrid">
            <div class="loader">L√§dt Drucker</div>
        </div>
    </div>

    <!-- ADD/EDIT MODAL -->
    <div id="printerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">‚ûï Drucker hinzuf√ºgen</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <form id="printerForm" onsubmit="savePrinter(event)">
                <div class="form-group">
                    <label for="printerName">Name *</label>
                    <input type="text" id="printerName" required 
                           placeholder="z.B. Bambu X1C, Ender 3 V2">
                </div>

                <div class="form-group">
                    <label for="printerType">Typ *</label>
                    <select id="printerType" required onchange="updateFormFields()">
                        <option value="">-- Typ w√§hlen --</option>
                        <option value="bambu">Bambu Lab (MQTT)</option>
                        <option value="klipper">Klipper (Moonraker)</option>
                        <option value="manual">Manuell (kein API)</option>
                    </select>
                </div>

                <!-- Network Settings (Bambu + Klipper) -->
                <div id="networkFields" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="printerIp">IP-Adresse *</label>
                            <input type="text" id="printerIp" 
                                   placeholder="192.168.1.100"
                                   pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$">
                        </div>

                        <div class="form-group">
                            <label for="printerPort">Port</label>
                            <input type="number" id="printerPort" 
                                   placeholder="Standard: 6000 (Bambu) / 7125 (Klipper)">
                        </div>
                    </div>
                </div>

                <!-- Bambu Specific -->
                <div id="bambuFields" style="display: none;">
                    <div class="form-group">
                        <label for="printerSerial">Seriennummer</label>
                        <input type="text" id="printerSerial" 
                               placeholder="z.B. 01S00C123456789">
                        <small style="color: var(--text-dim);">F√ºr Bambu Cloud (optional)</small>
                    </div>

                    <div class="form-group">
                        <label for="printerApiKey">Access Code</label>
                        <input type="text" id="printerApiKey" 
                               placeholder="12345678">
                        <small style="color: var(--text-dim);">8-stelliger LAN Access Code</small>
                    </div>
                </div>

                <!-- Klipper Specific -->
                <div id="klipperFields" style="display: none;">
                    <div class="form-group">
                        <label for="printerApiKeyKlipper">API Key</label>
                        <input type="text" id="printerApiKeyKlipper" 
                               placeholder="Moonraker API Key (optional)">
                    </div>
                </div>

                <input type="hidden" id="printerId">

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">
                        Abbrechen
                    </button>
                    <button type="submit" class="btn btn-primary">
                        üíæ Speichern
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- DELETE CONFIRMATION MODAL -->
    <div id="deleteModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>üóëÔ∏è Drucker l√∂schen?</h2>
                <button class="modal-close" onclick="closeDeleteModal()">&times;</button>
            </div>
            <p style="margin: 20px 0; color: var(--text-dim);">
                M√∂chten Sie diesen Drucker wirklich l√∂schen? Zugeh√∂rige Jobs bleiben erhalten.
            </p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeDeleteModal()">
                    Abbrechen
                </button>
                <button class="btn" style="background: var(--error); color: white;" onclick="confirmDelete()">
                    üóëÔ∏è L√∂schen
                </button>
            </div>
        </div>
    </div>

    <script src="/frontend/dashboard.js"></script>
    <script src="/frontend/printers.js"></script>
</body>
</html>
